---
title: 3 vegan - diversity, rarefaction, and species richness
author:
  - first_name: "Zhehao"
    last_name: "Hu"
    url: https://github.com/zzzhehao
    affiliation: Universit√§t Hamburg
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 8pt
bibliography:
  - "`r system('kpsewhich ../../../../005\\ Tools/Academic/Bib/MSc.bib', intern=TRUE)`"
output:
  distill::distill_article:
    toc: true
    toc_depth: 3
    highlight: rstudio
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "../Distill"
    )
  })
---

```{r setup, include=FALSE}
library(tidyverse)
library(vegan)
library(readxl)
library(rmarkdown)

setwd("/Users/hu_zhehao/Library/Mobile Documents/com~apple~CloudDocs/Files/Obsidian/Cafe AgX HQ 2.0/004 Notes/M.Sc. Biology/Community Ecology")
community<- read_excel("Practice/Diversity_test_data.xlsx", sheet = "Test")
```

# Raw

`?vegdist`: **Gower**, **Bray--Curtis**, indices are good in detecting underlying ecological gradients (Faith et al. 1987). Why using dissimilarity instead similarity?

our samples: rarefaction set to minimal sample size of 5, a descent analysis will take this out and analyse is again.



# Introduction into the pacakge `vegan`

We use the data from `Diversity_test_data.xlsx`:

```{r echo=FALSE}
str(community)
paged_table(head(community))
```

## Diversity

`diversity()` calculates the ecological diversity indeces, with Shannon index being default, a simpson or invisimpson index can be specified.

```{r}
simpson <- diversity(community[,3:11], "simpson") 
simpson 

shannon <- diversity(community[,3:11])
shannon #Typically ranges from 1.5 - 3.4, higher = more diverse 
```

```{r echo=FALSE}
par(mfrow = c(1, 2))  # use par to generate panels with 1 row of 2 graphs
hist(simpson)
hist(shannon)
```

Simpson index shows the probability of randomly drawing two observations given the observations are from different species.

Shannon index gives more importance to rare species, therefore shows higher frequency of the intermediate value.

## Dissimilarity

```{r echo=FALSE}
par(mfrow = c(1, 2))
bray = vegdist(community[,3:11], "bray") #Bray-Curtis does not include joint absences 
gower = vegdist(community[,3:11], "gower") #Gower includes joint absences
hist(bray, xlim = range(0.0,1.0))
hist(gower, xlim = range(0.0,1.0))
```

## Rarefaction, Species richness

```{r}
spAbund <- rowSums(community[,3:11])
spAbund
raremin <- min(spAbund)
raremin
```

```{r}
sRare <- rarefy(community[1,3:11], sample = raremin)
sRare
```



```{r}
rarecurve(community[,3:11], col = 'blue')
```